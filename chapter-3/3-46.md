## Exercise 3.46

If the `test-and-set!` operation is not atomic, the below timing diagram illustrates how two users Peter and Paul could try to acquire the same mutex at the same time. The mutex could be for the serializer of a bank account that they are both trying to access, as in the previous examples.

Instead of a bank balance, the mutable state shown is the `car` of the mutex cell list value, in the `make-mutex` definition.

If Peter and Paul call `test-and-set!` at the same time, and both access the value of `cell` when it is `false`, then the mutex will be acquired by both Peter and Paul, and they will both set `cell` to `true`, one setter overwriting the other.

It should be that only one of the users can "acquire" the mutex, locking the other user out, but both users will proceed with their transactions, so the mutex and any dependent serializer has failed.

![Timing diagram showing how mutex can fail with non-atomic `test-and-set!`](img/3-46.png)