# Exercise 4.17

![Environment diagram for `lambda` with `define`](img/4-17A.png)

*Environment diagram for `lambda` with `define`*

![Environment diagram for `lambda` with `define`](img/4-17B.png)

*Environment diagram for `lambda` with `let`*

The addition of a `let` to the transform program introduces an additional environment frame inside the `let`.

Since the entire procedure is enclosed inside the frame and inside environment E2, nothing can access E1 except `let` itself, and `let` is written in such a way that it doesn't access anything in E1 as there are no variables to access.

In order to make the interpreter implement "simultaneous" scope without constructing the extra frame, it will require thinking in terms of how the evaluator interprets `define`, rather than transforming `define` into `let`.

Within `make-procedure` we can scan the body and replace the definitions with calls to `define-variable!`, setting the variables to `*unassigned"`. Subsequently we can set the variables using `set-variable-value!` to their evaluated expressions.

Setting the variables directly in the evaluator means we can use the existing environment frame without creating a new frame.